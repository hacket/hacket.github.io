---
date_created: Friday, February 23rd 2017, 10:10:44 pm
date_updated: Thursday, January 23rd 2025, 12:30:12 am
title: JVM概念
author: hacket
categories:
  - Java&Kotlin
category: JVM
tags: [JVM]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
date created: 2024-12-27 23:42
date updated: 2024-12-27 23:42
aliases: [JVM 基础]
linter-yaml-title-alias: JVM 基础
---

# JVM 基础

## JVM 概念

JVM 是 java 的核心，是 Java 可以一次编译到处运行的本质所在。<br>JVM 与操作系统的关系:<br>![](https://cdn.nlark.com/yuque/0/2023/png/694278/1693582582316-34d20597-b901-465f-8b65-5bd6a21ee511.png#averageHue=%23fbf8f7&clientId=u9bbe1740-557f-4&from=paste&id=udf78bd3e&originHeight=890&originWidth=2106&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u0055fa1a-09f3-4156-aef0-14db0186c8e&title=)<br>从图中可以看到，有了 JVM 这个抽象层之后，Java 就可以实现跨平台了。JVM 只需要保证能够正确执行 .class 文件，就可以运行在诸如 Linux、Windows、MacOS 等平台上了。

## JVM 的组成和运行原理

JVM 有多种实现，使用最广泛的是 Oracle 的 HotSpot JVM。

### JVM 在 JDK 中的位置

JDK 是 java 开发的必备工具箱，JDK 其中有一部分是 JRE，JRE 是 JAVA 运行环境，JVM 则是 JRE 最核心的部分。下图是 JDK Standard Edition 的组成图：<br>![](https://cdn.nlark.com/yuque/0/2023/png/694278/1693582600243-7b17f9ae-7a8c-415c-a6fb-1fbb6b0d6e1f.png#averageHue=%23d7a230&clientId=u9bbe1740-557f-4&from=paste&id=u5720356e&originHeight=499&originWidth=690&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=ub13c8da6-0133-4975-895e-c4502d335dd&title=)<br>HotSpot 是 Oracle 关于 JVM 的商标，区别于 IBM，HP 等厂商开发的 JVM。`Java HotSpot Client VM` 和 `Java HotSpot Server VM` 是 JDK 关于 JVM 的两种不同的实现，前者可以减少启动时间和内存占用，而后者则提供更加优秀的程序运行速度。

### JVM 组成

JVM 由四大部分组成：ClassLoader，Runtime Data Area，Execution Engine，Native interface。<br>![](https://cdn.nlark.com/yuque/0/2023/png/694278/1693582614337-4128dd6a-aada-4908-b5e5-f226fa4ed1e1.png#averageHue=%23dfdf9f&clientId=u9bbe1740-557f-4&from=paste&id=u6c362366&originHeight=384&originWidth=606&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u6f46f607-dd5b-4571-b1b9-483ceb1fcc0&title=)<br>或者：<br>![](https://cdn.nlark.com/yuque/0/2023/png/694278/1693582623273-184b8109-ae3c-452f-af14-6a4118c1a571.png#averageHue=%23e1d7c9&clientId=u9bbe1740-557f-4&from=paste&id=ud052a6bf&originHeight=930&originWidth=966&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=ud2007b81-c545-4c51-9216-d0364ceec12&title=)

#### ClassLoader 类加载器

ClassLoader 是负责加载 class 文件。class 文件在文件开头有特定的文件标示，并且 ClassLoader 只负责 class 文件的加载，至于它是否可以运行，则由 Execution Engine 决定。

#### Native Interface 本地接口

Native Interface 是负责调用本地接口的。它的作用是调用不同语言的接口给 Java 用，它会在 Native Method Stack 中记录对应的本地方法，然后调用该方法时就通过 Execution Engine 加载对应的本地 lib。原本多于用一些专业领域，如 JAVA 驱动，地图制作引擎等，现在关于这种本地方法接口的调用已经被类似于 Socket 通信，WebService 等方式取代。

#### Execution Engine 执行引擎

Execution Engine 是执行引擎，也叫 Interpreter。class 文件被加载后，会把指令和数据信息放入内存中，Execution Engine 则负责把这些命令解释给操作系统。

#### Runtime Data Area 运行时数据区

Runtime Data Area 是存放数据的。分为五部分：Stack、Heap、Method Area、PC Register、Native Method Stack。几乎所有的关于 Java 内存方面的问题，都是集中在这块。<br>具体参考：`JVM Runtime Data Area.md`<br>![](https://cdn.nlark.com/yuque/0/2023/png/694278/1693582648948-58410003-241c-4762-9052-9b745531178d.png#averageHue=%23e7f0d7&clientId=u9bbe1740-557f-4&from=paste&id=u854ecaf8&originHeight=419&originWidth=823&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=ua803274b-1228-4324-a928-5340363b639&title=)

## JVM 运行原理简介

Java 程序被 javac 工具编译成.class 字节码文件后，我们执行 java 命令，该 class 文件便被 JVM 的 ClassLoader 加载。可以看出 JVM 的启动是通过 JAVA Path 下的 java.exe 或者 java 进行的。JVM 的初始化、运行到结束大概包括这么几步：<br>调用操作系统 API 判断系统的 CPU 架构，根据对应 CPU 类型寻找位于 JRE 目录下的/lib/jvm.cfg 文件，然后通过该配置文件找到对应的 jvm.dll 文件（如果我们参数中有 -server 或者 -client，则加载对应参数所指定的 jvm.dll，启动指定类型的 JVM），初始化 jvm.dll 并且挂接到 JNIENV 结构的实例上，之后就可以通过 JNIENV 实例装载并且处理 class 文件了。class 文件是字节码文件，它按照 JVM 的规范，定义了变量，方法等的详细信息，JVM 管理并且分配对应的内存来执行程序，同时管理垃圾回收。直到程序结束，一种情况是 JVM 的所有非守护线程停止，一种情况是程序调用 System.exit()，JVM 的生命周期也结束。

## JVM 学习类图

- 「深入理解 Java 虚拟机:JVM 高级特性与最佳实践 (第 2 版)」时记录的笔记<br> ![](https://cdn.nlark.com/yuque/0/2023/png/694278/1693582663490-e010258a-f867-4ebd-9ee0-802d51c55d9a.png#averageHue=%233b4245&clientId=u9bbe1740-557f-4&from=paste&id=u742a8faa&originHeight=2856&originWidth=3678&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u15c267c0-51ea-42bf-ba42-c3c6a3f33f9&title=)
- 实战 JVM 虚拟机

![jvm-实战Java虚拟机脑图.jpg](https://cdn.nlark.com/yuque/0/2023/jpeg/694278/1693584263661-e9bf2606-c21c-4db5-b68d-2338391515fc.jpeg#averageHue=%23eaecee&clientId=ue0fc1c56-db9c-4&from=paste&height=515&id=u18867a90&originHeight=772&originWidth=1201&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=126740&status=done&style=none&taskId=udbdf5e5b-c6f8-4651-83f3-0474d871fc3&title=&width=800.6666666666666)

![JVM详细学习路径脑图.png](https://cdn.nlark.com/yuque/0/2023/png/694278/1693584283269-75c5a807-ea26-40fe-b25a-2ffceb3820cd.png#averageHue=%233b4245&clientId=ue0fc1c56-db9c-4&from=paste&height=1904&id=u4f68c7c7&originHeight=2856&originWidth=3678&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1211311&status=done&style=none&taskId=uab431151-1c29-4fe6-9815-a2df2b070c1&title=&width=2452)
