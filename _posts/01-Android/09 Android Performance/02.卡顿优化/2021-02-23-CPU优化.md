---
banner: 
date_created: Friday, February 23rd 2021, 10:10:45 pm
date_updated: Wednesday, February 12th 2025, 12:35:40 am
title: CPU优化
author: hacket
categories:
  - 性能优化
category: 卡顿
tags: [卡顿, 性能优化, CPU]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
date created: 2024-12-24 00:39
date updated: 2024-12-24 00:39
aliases: [锁优化]
linter-yaml-title-alias: 锁优化
---

# 锁优化

目标：减少 CPU 空转

## 避免锁竞争

## by lazy

使用 `by lazy` 时需要注意几个性能相关的点：

1. 初始化成本：虽然延迟初始化可以推迟成本，但初始化时的开销仍然存在
2. 内存占用：lazy 对象会持有初始化 lambda 的引用
3. 多生成一个对象？
4. 线程安全开销：默认的同步模式会有一定的性能开销

可以通过配置 lazy 的模式来优化性能：

```kotlin
private val value by lazy(LazyThreadSafetyMode.PUBLICATION) { 
    // 使用PUBLICATION模式可能会执行多次，但性能更好
    computeValue() 
}
```
