---
date_created: Friday, February 23rd 2023, 10:10:45 pm
date_updated: Thursday, January 30th 2025, 9:20:57 am
title: 被hook恶搞
author: hacket
categories:
  - 性能优化
category: 稳定性
tags: [Crash, 性能优化, 稳定性]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
date created: 2024-12-24 00:39
date updated: 2024-12-24 00:39
linter-yaml-title-alias: hook
aliases: [hook]
---

# hook

## `Fatal Exception: java.lang.IllegalArgumentException: result has type long, got java.lang.String at android.os.BaseBundle.getLong(<Xposed>)`

**报错堆栈：**<br>![fyh0o](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/fyh0o.png)<br>**疑问：**

1. 代码调用是在 Log 输出时调用，但线上包不会输出 Log
2. ReferrerDetails�的 getInstallBeginTimestampSeconds 逻辑，即使存了 String 值，获取到的也是 0L 默认值，不会崩溃
   - 看了代码是报错在 Google Install Referer 中

```java
public long getInstallBeginTimestampSeconds() {
    return this.mOriginalBundle.getLong("install_begin_timestamp_seconds");
}
```

- getLong 逻辑

```java
public long getLong(String key) {
    unparcel();
    return getLong(key, 0L);
}
public long getLong(String key, long defaultValue) {
    unparcel();
    Object o = mMap.get(key);
    if (o == null) {
        return defaultValue;
    }
    try {
        return (Long) o;
    } catch (ClassCastException e) {
        typeWarning(key, o, "Long", defaultValue, e);
        return defaultValue;
    }
}
```

3. 再加上上面堆栈有带 Xposed 字眼，可以推测这是有人在用 Xposed 框架恶搞我们的 APP
