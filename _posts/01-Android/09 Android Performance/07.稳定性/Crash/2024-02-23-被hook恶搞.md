---
date_created: Friday, February 23rd 2024, 10:10:45 pm
date_updated: Wednesday, January 22nd 2025, 8:29:13 am
title: 被hook恶搞
author: hacket
categories:
  - 性能优化
category: 稳定性
tags: [稳定性, 性能优化, Crash]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
date created: 2024-12-24 00:39
date updated: 2024-12-24 00:39
linter-yaml-title-alias: hook
aliases: [hook]
---

# hook

## `Fatal Exception: java.lang.IllegalArgumentException: result has type long, got java.lang.String at android.os.BaseBundle.getLong(<Xposed>)`

**报错堆栈：**<br>![image.png](https://cdn.nlark.com/yuque/0/2023/png/694278/1688615236567-75533ff8-0d76-4b67-81f7-c9dad077c206.png#averageHue=%23f9f9f9&clientId=u9c12f14e-a255-4&from=paste&height=606&id=u93e2933c&originHeight=1212&originWidth=2230&originalType=binary&ratio=2&rotation=0&showTitle=false&size=285033&status=done&style=none&taskId=u423064f0-fc9b-40f1-bcbb-c91bdcef404&title=&width=1115)<br>**疑问：**

1. 代码调用是在 Log 输出时调用，但线上包不会输出 Log
2. ReferrerDetails�的 getInstallBeginTimestampSeconds 逻辑，即使存了 String 值，获取到的也是 0L 默认值，不会崩溃
   - 看了代码是报错在 Google Install Referer 中

```java
public long getInstallBeginTimestampSeconds() {
    return this.mOriginalBundle.getLong("install_begin_timestamp_seconds");
}
```

- getLong 逻辑

```java
public long getLong(String key) {
    unparcel();
    return getLong(key, 0L);
}
public long getLong(String key, long defaultValue) {
    unparcel();
    Object o = mMap.get(key);
    if (o == null) {
        return defaultValue;
    }
    try {
        return (Long) o;
    } catch (ClassCastException e) {
        typeWarning(key, o, "Long", defaultValue, e);
        return defaultValue;
    }
}
```

3. 再加上上面堆栈有带 Xposed 字眼，可以推测这是有人在用 Xposed 框架恶搞我们的 APP
