---
banner: 
date_created: Thursday, February 13th 2025, 10:18:31 am
date_updated: Thursday, April 10th 2025, 8:51:08 am
title: Frida
author: hacket
categories:
  - Androidè¿›é˜¶
category: ç©æœº
tags: [ç©æœº, Frida]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
aliases: [Frida]
linter-yaml-title-alias: Frida
---

# Frida

## Frida ç¯å¢ƒå®‰è£…

### frida ã€frida-tools

```shell
# å®‰è£…frida
pip install frida -i https://pypi.mirrors.ustc.edu.cn/simple/
# å®‰è£…frida-tools
pip install frida-tools -i https://pypi.mirrors.ustc.edu.cn/simple/
# å¦‚æœæŠ¥é”™ï¼Œéœ€è¦æ›´æ–°
python -m pip install --upgrade pip
# å¦‚æœç½‘ç»œæ²¡æœ‰é—®é¢˜è¿˜æ˜¯æŠ¥é”™ï¼Œæ¢ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼š
python -m pip install -U --force-reinstall pip
## ç­‰å¾…å®‰è£…fridaæˆåŠŸå³å¯

# fridaå®‰è£…æˆåŠŸåçš„æµ‹è¯•æŒ‡ä»¤ï¼š
frida help
# æŸ¥çœ‹fridaç‰ˆæœ¬
frida version
```

### frida-server

- frida-server çš„ [ä¸‹è½½](https://github.com/frida/frida/releases)ï¼šè¦çœ‹æ¸…æ¥š frida-server è¦å¾€ä¸‹æ»‘æ‰èƒ½çœ‹è§ï¼Œï¼ˆåç¼€ä¸º.xzï¼‰æˆ‘ç†è§£çš„å°±æ˜¯ç±»ä¼¼äºäºŒè¿›åˆ¶
- frida-server çš„ç‰ˆæœ¬éœ€è¦å’Œ frida ç‰ˆæœ¬ä¸€è‡´
- ä½¿ç”¨ adb å‘½ä»¤ï¼šå¦‚ä¸‹ï¼Œæˆ‘çš„æ‰‹æœº/æ¨¡æ‹Ÿå™¨å°±æ˜¯ x86_64ï¼Œåœ¨å»æ‰¾å¯¹åº”çš„ frida-server åç¼€ x86_64 ä¸‹è½½:

```shell
adb shell getprop ro.product.cpu.abi
# arm64-v8aï¼Œéœ€è¦ä¸‹è½½64ä½çš„ç‰ˆæœ¬ï¼šfrida-server-16.7.3-android-x86_64.xz
```

- **x86 (32-bit)**:Â `frida-server-*-android-x86.xz`
- **x86_64 (64-bit)**:Â `frida-server-*-android-x86_64.xz`
- **ARM (32-bit)**:Â `frida-server-*-android-arm.xz`
- **ARM64**:Â `frida-server-*-android-arm64.xz`
- ä¸‹è½½åå°†.xz è§£å‹å‡ºæ¥ï¼Œadb push åˆ°æ‰‹æœºä¸Šï¼š

```shell
# è§£å‹å¾—åˆ°ï¼šfrida-server-16.7.3-android-x86_64
# adb push; è·¯å¾„ç½‘ä¸Šå¤§éƒ¨åˆ†éƒ½æ˜¯data/local/tmpï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰å…³ç³»çš„ï¼›å¦‚æœæ”¾åˆ°/sdcard/downloadç›®å½•ä¸‹ï¼Œchmod 755ä¸ç”Ÿæ•ˆ
adb push ./frida-server-16.7.3-android-x86_64 data/local/tmp

adb shell 
cd /data/local/tmp

# æ›´æ”¹æƒé™å¯æ‰§è¡Œ
chmod 755 ./frida-server-16.7.3-android-x86_64
```

- å¯åŠ¨ frida-server

```shell
cd /data/tmp/local
./frida-server-16.7.3-android-x86_64

#ç›‘å¬ç«¯å£
./frida-server-16.7.3-android-x86_64 -l 0.0.0.0:8888
```

**æ–°ç‰ˆ Frida ä¸éœ€è¦è½¬å‘ç«¯å£**

- æŠ¥é”™

æŠ¥é”™ 1ï¼š[Unable to load SELinux policy from the kernel: Failed to open file â€œ/sys/fs/selinux/policyâ€: Permission denied Â· Issue #597 Â· frida/frida](https://github.com/frida/frida/issues/597)

```
Unable to load SELinux policy from the kernel: Failed to open file ?/sys/fs/selinux/policy?: Permission denied
```

è§£å†³ 1ï¼šéœ€è¦ su æƒé™

æŠ¥é”™ 2ï¼š[Unable to save SELinux policy to the kernel: Out of memory Â· Issue #473 Â· frida/frida](https://github.com/frida/frida/issues/473)

```
Unable to save SELinux policy to the kernel: Out of memory
```

è§£å†³ 2ï¼š

```shell
su ./frida-server-16.7.3-android-arm64 &
# åŠ &ï¼Œè¡¨ç¤ºä»¥åå°æ¨¡å¼è¿è¡Œ
```

- å’Œ `frida-server` äº¤äº’ï¼Œå‰ææ˜¯é€šè¿‡ USB è¿æ¥

```shell
frida-ps -U
```

### vscode é…ç½®ä»£ç æç¤º

é¦–å…ˆå®‰è£… [Node.js (nodejs.org)](https://nodejs.org/zh-cn)ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨ç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ã€‚

```shell
npm i @types/frida-gum
```

## Objection

Frida + Objectionï¼ŒåŠ¨æ€ä»£ç æ’æ¡©ï¼Œæ”¯æŒ Hook æ–¹æ³•ã€ç›‘æ§æ–‡ä»¶æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€åŠ è§£å¯†å‡½æ•°ç­‰ã€‚

- **ä¼˜ç‚¹**ï¼š
	- æ— éœ€ Xposedï¼Œæ”¯æŒé Root è®¾å¤‡ï¼ˆéƒ¨åˆ†åŠŸèƒ½éœ€ Rootï¼‰ã€‚
	- çµæ´»æ€§å¼ºï¼Œå¯ç¼–å†™è‡ªå®šä¹‰è„šæœ¬ã€‚
	- Objection æä¾›ç®€åŒ–å‘½ä»¤ï¼ˆå¦‚Â `android hooking watch`ï¼‰ã€‚
[GitHub - sensepost/objection: ğŸ“± objection - runtime mobile exploration](https://github.com/sensepost/objection)

## Frida ä½¿ç”¨

### frida-tools ä½¿ç”¨

frida tools ä¸»è¦æœ‰**Frida CLI**ã€**frida-ps**ã€**frida-trace**ã€**frida-discover**ã€**frida-ls-devices**ã€**frida-kill**ç­‰å‘½ä»¤å·¥å…·ã€‚

#### frida cli

- _**frida-ls-devices**_
æŸ¥çœ‹ç”µè„‘è¿æ¥çš„è®¾å¤‡ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬**UDID**ã€**è¿æ¥æ–¹å¼**ã€**è®¾å¤‡åç§°**ï¼Œå¦‚ä¸‹æ‰€ç¤º
![202504090839860](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202504100838458.png)

- _**frida-ps -U**_ Â æŸ¥çœ‹é€šè¿‡ USB è¿æ¥çš„è®¾å¤‡ä¸Šè¿è¡Œçš„ç¨‹åº
- _**frida-ps -Ua**_ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº
![202504090840588](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202504100838464.png)
- _**frida-ps -Uai**_Â æŸ¥çœ‹è®¾å¤‡å·²ç»å®‰è£…çš„åº”ç”¨ç¨‹åº
- `frida-ps -D <UDID>`Â é€šè¿‡è®¾å¤‡çš„ UDID æŸ¥çœ‹è®¾å¤‡ä¸­åº”ç”¨ç¨‹åºä¸­çš„ pidã€è¿›ç¨‹åï¼Œ
- `frida-kill -D <UDID> <pid>`Â  æ€æ­»æŒ‡å®š UDID çš„è®¾å¤‡çš„å…·ä½“è¿›ç¨‹ï¼Œpid ä¸ºè¯¥è¿›ç¨‹çš„è¿›ç¨‹å·

## å®æˆ˜

### Hook æ­¥éª¤

ä»¥ Android å¹³å°ä¸ºä¾‹ï¼Œäº†è§£ä¸€ä¸‹ frida çš„å·¥ä½œæµç¨‹:

- frida-serverï¼šè¿è¡Œåœ¨å®‰å“ç«¯ï¼Œä¸ç”µè„‘ç«¯è¿›è¡Œé€šä¿¡ï¼Œæ¥æ”¶ç”µè„‘ç«¯çš„è°ƒè¯•è¯·æ±‚ï¼Œå¹¶å°† JavaScript ç¼–å†™çš„ hook ä»£ç æ³¨å…¥åˆ°ç›®æ ‡ app ä¸­ã€‚
- ç”µè„‘ç«¯ï¼šä¸ frida-server é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–å†™è„šæœ¬å’Œç®¡ç†æ³¨å…¥è¿‡ç¨‹ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ Python
- JavaScript è„šæœ¬ï¼šç¼–å†™å…·ä½“çš„æ³¨å…¥å’Œä¿®æ”¹é€»è¾‘ï¼Œå¹¶é€šè¿‡ç”µè„‘ç«¯æä¾›çš„ç¯å¢ƒè¢«æ¨é€åˆ° frida-server ä¸­ï¼Œä»è€Œæ³¨å…¥åˆ°ç›®æ ‡ appã€‚

### demo

å¯¹æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªÂ `hook.js`Â ç”¨äºå­˜æ”¾å…·ä½“çš„ä¿®æ”¹é€»è¾‘ï¼Œä¸€ä¸ªÂ `hook.py`Â ç”¨äºè‡ªåŠ¨ç®¡ç†æ³¨å…¥æµç¨‹ï¼Œå¦‚ï¼šåœ¨åˆé€‚çš„æ—¶æœºè‡ªåŠ¨æ³¨å…¥ã€‚

- hook.py

```python
import frida
import sys
import time

# åº”ç”¨åŒ…å
app_package_name = 'me.hacket.demos'

# å»¶è¿Ÿæ³¨å…¥æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé˜²æ­¢dexæœªåŠ è½½
delay_time = 2


# hookè„šæœ¬æ‰€åœ¨è·¯å¾„
hookJs='hook.js'

def on_message(message, data):
    if message['type'] == 'send':
        print("[*] {0}".format(message['payload']))
    elif message['type'] == 'error':
        print("[!] {0}".format(message['stack']))

# å¯åŠ¨åº”ç”¨ç¨‹åº
device = frida.get_usb_device()
print("Device: %s" % device)
print("app_package_name: %s" % app_package_name)
pid = device.spawn([app_package_name])
print("Pid: %d" % pid)
device.resume(pid)
time.sleep(1)  # ç­‰å¾…åº”ç”¨ç¨‹åºå¯åŠ¨

# å»¶è¿Ÿæ³¨å…¥
print(f"Waiting for {delay_time} seconds before injecting script...")
time.sleep(delay_time)

# æ³¨å…¥è„šæœ¬
with open(hookJs, 'r',encoding='utf-8') as f:
    script_code = f.read()

session = device.attach(pid)
script = session.create_script(script_code)
script.on('message', on_message)
script.load()
print("[*] Script injected successfully.")
sys.stdin.read()
```

- hook.js

```js
// ä»å†…å­˜ä¸­å¯»æ‰¾åŒ…å«androidå­—æ ·çš„ç±»å¹¶æ‰“å°
Java.perform(function () {
  Java.enumerateLoadedClasses({
    onMatch: function (className) {
      if (className.includes("android")) {
        console.log(className);
      }
    },
    onComplete: function () {
      console.log("Class enumeration complete");
    },
  });
});
```

- æ‰§è¡Œ hook

```shell
python hook.py
```

## æŠ¥é”™

### Windows ä¸ŠæŠ¥é”™ï¼šneed Gadget to attach on jailed

![202504100040649](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202504100838466.png)

é”™è¯¯æ˜¾ç¤ºï¼šé—®é¢˜å‡ºåœ¨è¿™ä¸ª `C:\Users\XXX\AppData\Local\Microsoft\Windows\INetCache\frida\gadget-android-arm64.so` æ–‡ä»¶ä¸­ã€‚

ä½†æ˜¯å½“æˆ‘ä»¬å»è®¿é—®è¿™ä¸ªæ–‡ä»¶å¤¹æ—¶ï¼Œå‘ç°è¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨

å› æ­¤æˆ‘ä»¬è‡ªå·±åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¤¹ï¼š

`C:\Users\XXX\AppData\Local\Microsoft\Windows\INetCache\frida\`

å»ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ï¼š [`gadget-android-arm64.so`](https://github.com/frida/frida/releases)

ä¸‹è½½å®Œæˆåè§£å‹ï¼Œå¹¶å°†æ–‡ä»¶é‡å‘½åä¸º `gadget-android-arm64.so`

æ”¾åˆ° `C:\Users\XXX\AppData\Local\Microsoft\Windows\INetCache\frida\gadget-android-arm64.so`

- [fridaæŠ¥é”™need Gadget....(æœ‰æ•ˆè§£å†³æ–¹æ³•)\_failed to spawn: need gadget to attach on jailed a-CSDNåšå®¢](https://blog.csdn.net/m0_65663088/article/details/135994176)

## Ref

- [Frida åŸç†åŠç®€å•ä½¿ç”¨ - Only-xiaoxiao - åšå®¢å›­](https://www.cnblogs.com/Only-xiaoxiao/p/17294561.html)
