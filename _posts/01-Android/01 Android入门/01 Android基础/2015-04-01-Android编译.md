---
date_created: Monday, April 1st 2015, 1:27:34 am
date_updated: Monday, January 20th 2025, 1:13:57 am
title: Android编译
author: hacket
categories:
  - Android
category: Android基础
tags: []
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
aliases: [Android 编译]
linter-yaml-title-alias: Android 编译
---

# Android 编译

## 简易编译流程

![](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202501062300696.png)

## 完整编译流程

![](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202501062300701.png)

# D8 和 R8

## 早期 Android 生成 apk 过程

![](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202501062300702.webp)

- javac：将.java 文件编译成.class 文件
- desugar：用于将 Java8 的特性在 Android 平台上适配
- Proguard：用于剔除无用的 Java 代码并做一些优化
- dx：将所有的 Java 代码转换为 dex 格式

## D8 和 R8 引入

Android Studio 3.x 后，引入了 D8 Dex 编译器和 R8 混淆压缩工具。<br />![image.png](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202501062300703.png)

### D8

D8 编译器特点：

- 编译更快、时间更短
- DEX 编译时占用内容更小
- .dex 文件大小更小
- D8 编译的.dex 文件拥有相同或是更好的运行时性能

### R8

AS3.2 引入 R8 替换 Proguard，用于代码压缩 (shringking) 和混淆 (obfuscation)。

### AS3.4 D8 和 R8 合并

在 Android Studio 3.4 版本中，R8 把 desugaring、shrinking、obfuscating、optimizing 和 dexing 都合并到一步进行执行。在 Android Studio 3.4 以前的版本编译流程如下：<br />![](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202501062300704.webp)<br />合并之后编译流程如下：<br />![](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202501062300705.webp)

### 脱糖

脱糖用于在 Android 中支持 Java8 部分特性
