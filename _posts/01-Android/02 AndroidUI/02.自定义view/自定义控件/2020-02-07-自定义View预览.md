---
banner: 
date_created: Friday, February 7th 2020, 3:33:09 pm
date_updated: Wednesday, March 5th 2025, 12:32:17 am
title: 自定义View预览
author: hacket
categories:
  - AndroidUI
category: 自定义View
tags: [自定义View]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
aliases: [自定义 View 预览]
linter-yaml-title-alias: 自定义 View 预览
---

# 自定义 View 预览

## isInEditMode

**RecyclerView：**

```java
private void createLayoutManager(Context context, String className, AttributeSet attrs,  
        int defStyleAttr, int defStyleRes) {  
    if (className != null) {  
        className = className.trim();  
        if (!className.isEmpty()) {  
            className = getFullClassName(context, className);  
            try {  
                ClassLoader classLoader;  
                if (isInEditMode()) {  
                    // Stupid layoutlib cannot handle simple class loaders.  
                    classLoader = this.getClass().getClassLoader();  
                } else {  
                    classLoader = context.getClassLoader();  
                }  
                Class<? extends LayoutManager> layoutManagerClass =  
                        Class.forName(className, false, classLoader)  
                                .asSubclass(LayoutManager.class);  
                Constructor<? extends LayoutManager> constructor;  
                Object[] constructorArgs = null;  
                try {  
                    constructor = layoutManagerClass  
                            .getConstructor(LAYOUT_MANAGER_CONSTRUCTOR_SIGNATURE);  
                    constructorArgs = new Object[]{context, attrs, defStyleAttr, defStyleRes};  
                } catch (NoSuchMethodException e) {  
                    try {  
                        constructor = layoutManagerClass.getConstructor();  
                    } catch (NoSuchMethodException e1) {  
                        e1.initCause(e);  
                        throw new IllegalStateException(attrs.getPositionDescription()  
                                + ": Error creating LayoutManager " + className, e1);  
                    }  
                }  
                constructor.setAccessible(true);  
                setLayoutManager(constructor.newInstance(constructorArgs));  
            } catch (ClassNotFoundException e) {  
            // ... 
        }  
    }  
}
```

报错的地方，用 isInEditMode 过滤掉：

![image.png](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202503040058582.png)

解决：

![image.png](https://raw.githubusercontent.com/hacket/ObsidianOSS/master/obsidian/202503040059022.png)

## 技巧

### 不要用静态的 Context

如：

- AppContext.application
- 获取资源

```kotlin
// ViewUtils
public static int getColor(@ColorRes int idRes) {
	try {
		return ContextCompat.getColor(AppContext.application, idRes);
	} catch (Exception e) {
		e.printStackTrace();
		return Color.TRANSPARENT;
	}
}

// 原本
color = ViewUtils.getColor(AppContext.application, R.color.sui_color_white_alpha10)
// 改成：
color = ContextCompat.getColor(context, R.color.sui_color_white_alpha10)
```
