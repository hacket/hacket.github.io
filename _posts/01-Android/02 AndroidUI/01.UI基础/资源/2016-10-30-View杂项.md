---
date_created: Wednesday, October 30th 2016, 11:45:33 pm
date_updated: Monday, January 20th 2025, 11:35:22 pm
title: Viewæ‚é¡¹
author: hacket
categories:
  - AndroidUI
category: UIæ‚é¡¹
tags: [UIæ‚é¡¹]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
date created: æ˜ŸæœŸä¸‰, åæœˆ 30æ—¥ 2024, 11:44:00 ä¸­åˆ
date updated: æ˜ŸæœŸä¸€, ä¸€æœˆ 6æ—¥ 2025, 9:54:47 æ™šä¸Š
image-auto-upload: true
feed: show
format: list
aliases: [AttachInfo]
linter-yaml-title-alias: AttachInfo
---

# AttachInfo

## AttachInfo æ˜¯ä»€ä¹ˆï¼Ÿ

å½“ View attach åˆ° window æ—¶ï¼Œç»™ view çš„ä¸€äº›ä¿¡æ¯ï¼Œéƒ½å°è£…åœ¨ AttachInfoï¼›è¿™ä¸ªä¿¡æ¯æ˜¯ç”¨æ¥åœ¨çª—å£å¤„ç†ä¸­ç”¨çš„ï¼ŒAndroid çš„çª—å£ç³»ç»Ÿå°±æ˜¯ç”¨è¿‡ AttachInfo æ¥åˆ¤æ–­ View çš„æ‰€å±çª—å£çš„

View.AttachInfo é‡Œé¢çš„ä¿¡æ¯ï¼Œå°±æ˜¯ View å’Œ Window ä¹‹é—´çš„ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªè¢«æ·»åŠ åˆ°çª—å£ä¸Šçš„ View æˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ª AttachInfoï¼›åŒä¸€ä¸ª ViewRootImpl ä¸‹çš„ View çš„ AttachInfo éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œåœ¨ ViewRootImpl ä¼šè¿›è¡Œåˆ†å‘ï¼Œåœ¨ measure/layout å‰

## AttachInfo æºç 

```
// View.AttachInfo Android29
/**
 * A set of information given to a view when it is attached to its parent
 * window.
 */
final static class AttachInfo {
    interface Callbacks {
        void playSoundEffect(int effectId);
        boolean performHapticFeedback(int effectId, boolean always);
    }
    final IWindowSession mSession;

    final IWindow mWindow;

    final IBinder mWindowToken;

    Display mDisplay;

    final Callbacks mRootCallbacks;
    
    /**
     * The top view of the hierarchy.
     */
    View mRootView;
    
    boolean mHardwareAccelerated;
    boolean mHardwareAccelerationRequested;
    ThreadedRenderer mThreadedRenderer;
    List<RenderNode> mPendingAnimatingRenderNodes;
    
    final ViewTreeObserver mTreeObserver;
    
    Canvas mCanvas;

    /**
     * The view root impl.
     */
    final ViewRootImpl mViewRootImpl;
    
    final Handler mHandler;
    
    final Matrix mTmpMatrix = new Matrix();
    // ...
    AttachInfo(IWindowSession session, IWindow window, Display display,
            ViewRootImpl viewRootImpl, Handler handler, Callbacks effectPlayer,
            Context context) {
        mSession = session;
        mWindow = window;
        mWindowToken = window.asBinder();
        mDisplay = display;
        mViewRootImpl = viewRootImpl;
        mHandler = handler;
        mRootCallbacks = effectPlayer;
        mTreeObserver = new ViewTreeObserver(context);
    }
}
```

### AttachInfo æˆå‘˜å˜é‡

- mRootCallbacks AttachInfo.Callback
- mRootView View æ ‘æœ€é¡¶å±‚çš„ Viewï¼Œä¸€èˆ¬æ˜¯ DecorView
- mHardwareAccelerated æ˜¯å¦å¼€å¯ç¡¬ä»¶åŠ é€Ÿ
- mHandler ViewRootHandler
- mViewRootImpl ViewRootImpl
- ThreadedRenderer mThreadedRenderer;

#### ThreadedRenderer mThreadedRenderer

ç¡¬ä»¶åŠ é€Ÿçš„ render threadï¼Œåœ¨ ViewRootImpl#enableHardwareAcceleration åˆ›å»º

```java
private void enableHardwareAcceleration(WindowManager.LayoutParams attrs) {
    if (hardwareAccelerated) {
        mAttachInfo.mThreadedRenderer = ThreadedRenderer.create(mContext, translucent, attrs.getTitle().toString());
        // ...
    }
    // ...
}
```

### CallBack

- void playSoundEffect(int effectId) è¿™ä¸ªç”¨äºæ’­æ”¾æŒ‰é”®å£°éŸ³ï¼Œå‚æ•°æ˜¯è¿™ä¸ªç‚¹å‡»äº‹ä»¶çš„ç±»å‹ï¼›å¦‚æœæƒ³æ”¹æˆä¸åŒçš„å£°éŸ³ï¼Œåœ¨è‡ªå®šä¹‰çš„ View ä¸Šï¼Œé‡å†™ View#playSoundEffect æ–¹æ³•
- boolean performHapticFeedback(int effectId, boolean always) è§¦æ„Ÿåé¦ˆï¼Œéœ€è¦ç”¨æˆ·åœ¨ç³»ç»Ÿæ‰“å¼€è§¦æ„Ÿåé¦ˆé€‰é¡¹ï¼Œå‚æ•°å¯ä»¥çœ‹ HapticFeedbackConstants è¿™ä¸ªç±»

> æŠŠå‚æ•° `HapticFeedbackConstants.FLAG_IGNORE_GLOBAL_SETTING` å°±å¯ä»¥å¿½ç•¥å…¨å±€è®¾ç½®ï¼›å‚æ•° `HapticFeedbackConstants.FLAG_IGNORE_VIEW_SETTING` å°±å¯ä»¥å¿½ç•¥æˆ‘ä»¬åœ¨ View é‡Œé¢è®¾ç½®çš„ `android:hapticFeedbackEnabled`

### InvalidateInfo

InvalidateInfo ç”¨äºåˆ·æ–° UIï¼Œå½“æˆ‘ä»¬åˆ·æ–° UI çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ InvalidateInfo å¯¹è±¡ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ¥åˆ·æ–° UI

### AttachInfo ä½•æ—¶åˆ›å»ºï¼Ÿ

åœ¨ ViewRootImpl åˆ›å»ºæ—¶ï¼Œå°±åˆ›å»ºäº†

```java
// ViewRootImpl Android29
public class ViewRootImpl {
    final IWindowSession mWindowSession;
    final W mWindow;
    final ViewRootHandler mHandler = new ViewRootHandler();
    
    final View.AttachInfo mAttachInfo;
    public ViewRootImpl(Context context, Display display) {
        mWindowSession = WindowManagerGlobal.getWindowSession();
        mWindow = new W(this);
        mAttachInfo = new View.AttachInfo(mWindowSession, mWindow, display, this, mHandler, this,
                    context);
    }
}
```

### ä½•æ—¶åˆ†å‘ç»™ viewï¼Ÿ

åœ¨ç¬¬ä¸€æ¬¡ ViewRootImpl#performTraversals æ—¶ï¼Œåˆ†å‘ç»™ view

```java
// ViewRootImpl Android29
public class ViewRootImpl {
    private void performTraversals() {
        final View host = mView;
        if (mFirst) {
            host.dispatchAttachedToWindow(mAttachInfo, 0);
            mAttachInfo.mTreeObserver.dispatchOnWindowAttachedChange(true);
            dispatchApplyInsets(host);
        }
    }
}
```

è¿™é‡Œçš„ mView æ˜¯ DecorViewï¼ŒDecorView æ˜¯ä¸ª FrameLayoutï¼Œæœ€ç»ˆèµ°çš„æ˜¯ ViewGroup çš„ dispatchAttachedToWindow

```java
// ViewGroup Android29
void dispatchAttachedToWindow(AttachInfo info, int visibility) {
    mGroupFlags |= FLAG_PREVENT_DISPATCH_ATTACHED_TO_WINDOW;
    super.dispatchAttachedToWindow(info, visibility);
    mGroupFlags &= ~FLAG_PREVENT_DISPATCH_ATTACHED_TO_WINDOW;

    final int count = mChildrenCount;
    final View[] children = mChildren;
    for (int i = 0; i < count; i++) {
        final View child = children[i];
        child.dispatchAttachedToWindow(info,
                combineVisibility(visibility, child.getVisibility()));
    }
    final int transientCount = mTransientIndices == null ? 0 : mTransientIndices.size();
    for (int i = 0; i < transientCount; ++i) {
        View view = mTransientViews.get(i);
        view.dispatchAttachedToWindow(info,
                combineVisibility(visibility, view.getVisibility()));
    }
}
```

åœ¨ ViewGroup#dispatchAttachedToWindowï¼Œå…ˆè°ƒç”¨çš„ View#dispatchAttachedToWindowï¼Œç„¶åéå†æ‰€æœ‰å­ view#dispatchAttachedToWindowï¼Œç°åœ¨æˆ‘ä»¬çœ‹çœ‹çœ‹ View#dispatchAttachedToWindowï¼š

```java
// ViewGroup Android29
void dispatchAttachedToWindow(AttachInfo info, int visibility) {
    mAttachInfo = info; // ä¿å­˜AttachInfo
    mWindowAttachCount++;
    // ...
    onAttachedToWindow();
    // ...
    onVisibilityChanged(this, visibility);
}
```

View#dispatchAttachedToWindowï¼Œä¿å­˜ AttachInfoï¼›view ä¾èµ– window çš„æ•°é‡åŠ  1ï¼›è°ƒç”¨ onAttachedToWindowï¼›è°ƒç”¨ onVisibilityChanged

### AttachInfo èµ‹å€¼

- mRootView èµ‹å€¼ï¼Œåœ¨ ViewRootImpl#setViewï¼Œå®é™…è°ƒç”¨æ˜¯ WindowManagerGlobal#addView

```java
// ViewRootImpl Android29
public void setView(View view, WindowManager.LayoutParams attrs, View panelParentView) {
    if (mView == null) {
       mView = view;
       mAttachInfo.mRootView = view;
    }
}
```

- ç¡¬ä»¶åŠ é€Ÿ

```java
// ViewRootImpl Android29
private void enableHardwareAcceleration(WindowManager.LayoutParams attrs) {
    mAttachInfo.mHardwareAccelerated = false;
    mAttachInfo.mHardwareAccelerationRequested = false;
    // Don't enable hardware acceleration when the application is in compatibility mode
    if (mTranslator != null) return;
    
    final boolean hardwareAccelerated = (attrs.flags & WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED) != 0;
    if (hardwareAccelerated) {
        if (!ThreadedRenderer.isAvailable()) {
            return;
        }
        final boolean fakeHwAccelerated = (attrs.privateFlags &
                WindowManager.LayoutParams.PRIVATE_FLAG_FAKE_HARDWARE_ACCELERATED) != 0;
        final boolean forceHwAccelerated = (attrs.privateFlags &
                WindowManager.LayoutParams.PRIVATE_FLAG_FORCE_HARDWARE_ACCELERATED) != 0;
        if (fakeHwAccelerated) {
            mAttachInfo.mHardwareAccelerationRequested = true;
        } else if (!ThreadedRenderer.sRendererDisabled
                || (ThreadedRenderer.sSystemRendererDisabled && forceHwAccelerated)) {
            if (mAttachInfo.mThreadedRenderer != null) {
                mAttachInfo.mThreadedRenderer.destroy();
            }

            final Rect insets = attrs.surfaceInsets;
            final boolean hasSurfaceInsets = insets.left != 0 || insets.right != 0
                    || insets.top != 0 || insets.bottom != 0;
            final boolean translucent = attrs.format != PixelFormat.OPAQUE || hasSurfaceInsets;
            final boolean wideGamut =
                    mContext.getResources().getConfiguration().isScreenWideColorGamut()
                    && attrs.getColorMode() == ActivityInfo.COLOR_MODE_WIDE_COLOR_GAMUT;

            mAttachInfo.mThreadedRenderer = ThreadedRenderer.create(mContext, translucent,
                    attrs.getTitle().toString());
            mAttachInfo.mThreadedRenderer.setWideGamut(wideGamut);
            updateForceDarkMode();
            if (mAttachInfo.mThreadedRenderer != null) {
                mAttachInfo.mHardwareAccelerated =
                        mAttachInfo.mHardwareAccelerationRequested = true;
            }
        }
    }   
}
```

> è¯»å– WindowManager.LayoutParams.flagsï¼Œçœ‹æ˜¯å¦åŒ…å« `WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED` åˆ¤æ–­æ˜¯å¦å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼›ç¡¬ä»¶åŠ é€Ÿçš„ flagsï¼ˆFLAG_HARDWARE_ACCELERATEDï¼‰é»˜è®¤æ ¹æ®æ¸…å•æ–‡ä»¶çš„ application å’Œ activity èŠ‚ç‚¹çš„ hardwareAcceleratedï¼›ç¡¬ä»¶åŠ é€Ÿçš„ flags ä¹Ÿå¯é€šè¿‡ Window#setFlags æ¥èµ‹å€¼

- mHandler ViewRootHandlerï¼Œåœ¨ ViewRootImpl æ„é€ æ–¹æ³•èµ‹å€¼
- mViewRootImpl ViewRootImplï¼Œåœ¨ ViewRootImpl æ„é€ æ–¹æ³•èµ‹å€¼

### View ä¸­çš„ AttachInfo

- View æ˜¯å¦ attach åˆ° Window äº†

```java
// View Android29
public boolean isAttachedToWindow() {
    return mAttachInfo != null;
}
```

- åˆ¤æ–­æ˜¯å¦å¼€å¯äº†ç¡¬ä»¶åŠ é€Ÿ

```java
// View Android29
public boolean isHardwareAccelerated() {
    return mAttachInfo != null && mAttachInfo.mHardwareAccelerated;
}
```

- è·å– Handlerï¼Œ å¦‚æœ attach äº† View#post ä¹Ÿæ˜¯é€šè¿‡è¯¥ Handler#post

```java
// View Android29
public Handler getHandler() {
    final AttachInfo attachInfo = mAttachInfo;
    if (attachInfo != null) {
        return attachInfo.mHandler;
    }
    return null;
}
```

- è·å– ViewRootImpl

```java
// View Android29
public ViewRootImpl getViewRootImpl() {
    if (mAttachInfo != null) {
        return mAttachInfo.mViewRootImpl;
    }
    return null;
}
```

- è·å– ThreadedRenderer hide

```java
// View Android29
// @hide
public ThreadedRenderer getThreadedRenderer() {
    return mAttachInfo != null ? mAttachInfo.mThreadedRenderer : null;
}
```

- è·å– Window

```java
// View Android29
protected IWindow getWindow() {
    return mAttachInfo != null ? mAttachInfo.mWindow : null;
}
```

# Matrix

Matrix æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œä¸»è¦åŠŸèƒ½æ˜¯åæ ‡æ˜ å°„ï¼Œæ•°å€¼è½¬æ¢ã€‚

## Matrix åŸºæœ¬åŸç†

Matrix æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œæœ€æ ¹æœ¬çš„ä½œç”¨å°±æ˜¯åæ ‡è½¬æ¢ï¼Œä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹å‡ ç§å¸¸è§å˜æ¢çš„åŸç†:

> æˆ‘ä»¬æ‰€ç”¨åˆ°çš„å˜æ¢å‡å±äºä»¿å°„å˜æ¢ï¼Œä»¿å°„å˜æ¢æ˜¯ çº¿æ€§å˜æ¢ (ç¼©æ”¾ï¼Œæ—‹è½¬ï¼Œé”™åˆ‡) å’Œ å¹³ç§»å˜æ¢ (å¹³ç§») çš„å¤åˆ

åŸºæœ¬å˜æ¢æœ‰ 4 ç§: å¹³ç§» (translate)ã€ç¼©æ”¾ (scale)ã€æ—‹è½¬ (rotate) å’Œ é”™åˆ‡ (skew)ã€‚<br />å››ç§å˜æ¢éƒ½æ˜¯ç”±å“ªäº›å‚æ•°æ§åˆ¶çš„ã€‚<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/694278/1688142158175-698165c1-3978-4ef9-9ff6-81f840e337fa.png#averageHue=%23f4edc5&clientId=ue43ba475-2713-4&from=paste&height=314&id=uc1e6edb9&originHeight=471&originWidth=670&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=124227&status=done&style=none&taskId=u82690862-80f8-449a-8178-d6428c2c9a6&title=&width=446.6666666666667)<br />![](http://note.youdao.com/yws/res/51045/AC0946C1969841F89F24E4B35E83EB6E#id=PPpNm&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![image.png](https://cdn.nlark.com/yuque/0/2023/png/694278/1688142163760-ce4a2d73-702d-49c5-bb0a-689894d6cd24.png#averageHue=%23f0ede8&clientId=ue43ba475-2713-4&from=paste&height=226&id=u0e753cff&originHeight=339&originWidth=623&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=108214&status=done&style=none&taskId=ucdfeb32d-fa59-4881-8fdb-55b2b38bb02&title=&width=415.3333333333333)<br />å¯ä»¥çœ‹åˆ°æœ€åä¸‰ä¸ªå‚æ•°æ˜¯æ§åˆ¶é€è§†çš„ï¼Œè¿™ä¸‰ä¸ªå‚æ•°ä¸»è¦åœ¨ 3D æ•ˆæœä¸­è¿ç”¨ï¼Œé€šå¸¸ä¸º (0, 0, 1)<br />Matrix æºç å®šä¹‰ï¼š

```java
public class Matrix {

    public static final int MSCALE_X = 0;  
    public static final int MSKEW_X  = 1; 
    public static final int MTRANS_X = 2; 
    public static final int MSKEW_Y  = 3; 
    public static final int MSCALE_Y = 4; 
    public static final int MTRANS_Y = 5; 
    public static final int MPERSP_0 = 6; 
    public static final int MPERSP_1 = 7; 
    public static final int MPERSP_2 = 8; 
}
```

## Ref

- [ ] å®‰å“è‡ªå®šä¹‰ View è¿›é˜¶ -Matrix åŸç†<br /><https://www.gcssloop.com/customview/Matrix_Basic>

<https://blog.51cto.com/zensheno/513652>

# è‡ªå®šä¹‰ ViewGroup ä¸­ child ç»˜åˆ¶é¡ºåº

1. é‡å†™ isChildrenDrawingOrderEnabled æ–¹æ³•è¿”å› trueï¼Œè¡¨ç¤ºå¼€å¯è‡ªå®šä¹‰ç»˜åˆ¶é¡ºåº
2. .é‡å†™ getChildDrawingOrder æ–¹æ³•ï¼Œæ ¹æ®è‡ªå·±å®é™…éœ€æ±‚è¿”å› View çš„é¡ºåºã€‚ç”±äºæ–°æ·»åŠ çš„ View å…ˆç»˜åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€’åºè¿”å›

```kotlin
class CustomOrderDrawChildFrameLayout @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null
) : FrameLayout(context, attrs) {

    override fun isChildrenDrawingOrderEnabled(): Boolean {
        return true
    }

    override fun getChildDrawingOrder(childCount: Int, i: Int): Int {
        return childCount - i - 1 // å€’åº
    }
}
```

## Ref

- [x] è‡ªå®šä¹‰ ViewGroup ä¸­ child ç»˜åˆ¶é¡ºåº<br /><https://blog.csdn.net/ZYJWR/article/details/108164788>

# getDimension()ï¼ŒgetDimensionPixelOffset()ï¼ŒgetDimensionPixelSize() çš„åŒºåˆ«

- float getDimension(int id) Â -- çœŸå®çš„å°ºå¯¸

æ˜¯åŸºäºå½“å‰ DisplayMetrics è¿›è¡Œè½¬æ¢ï¼Œè·å–æŒ‡å®šèµ„æº id å¯¹åº”çš„å°ºå¯¸

- int getDimensionPixelOffset(int id) -- å–æ•´

ä¸ getDimension() åŠŸèƒ½ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å°†ç»“æœè½¬æ¢ä¸º intï¼Œå¹¶ä¸”åç§»è½¬æ¢æ˜¯ç›´æ¥æˆªæ–­å°æ•°ä½ï¼Œå³å–æ•´ï¼ˆå…¶å®å°±æ˜¯æŠŠ float å¼ºåˆ¶è½¬åŒ–ä¸º intï¼Œæ³¨æ„ä¸æ˜¯å››èˆäº”å…¥å“¦ï¼‰

- int getDimensionPixelSize(int id) Â -- å››èˆäº”å…¥

ä¸ getDimension() åŠŸèƒ½ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å°†ç»“æœè½¬æ¢ä¸º intï¼Œå¹¶ä¸”å°æ•°éƒ¨åˆ†å››èˆäº”å…¥ã€‚

ç®€å•ç²—æš´çš„è§£é‡Šå°±æ˜¯ï¼š<br />è¿™ä¸‰ä¸ªå‡½æ•°è¿”å›çš„éƒ½æ˜¯ç»å¯¹å°ºå¯¸ï¼Œè€Œä¸æ˜¯ç›¸å¯¹å°ºå¯¸ï¼ˆdp\sp ç­‰ï¼‰ã€‚<br />å¦‚æœ getDimension() è¿”å›ç»“æœæ˜¯ 20.5fï¼Œ<br />getDimensionPixelOffset() è¿”å›ç»“æœå–æ•´å°±æ˜¯ 20<br />getDimensionPixelSize() è¿”å›ç»“æœå››èˆäº”å…¥å°±æ˜¯ 21ã€‚

# View ç±»çš„å››ä¸ªæ„é€ å‡½æ•°

```
public View(Context context) {}
public View(Context context, AttributeSet attrs) {}
public View(Context context, AttributeSet attrs, int defStyleAttr) {}
public View(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) {
```

## 4 ä¸ªæ„é€ å‡½æ•°

### æ„é€ æ–¹æ³• View(Context context) Â ä»£ç  new å¯¹è±¡

åœ¨ä»£ç ä¸­åˆ›å»ºä¸€ä¸ª View çš„æ—¶å€™ä½¿ç”¨

### æ„é€ æ–¹æ³• View(Context context,[@Nullable](/Nullable) AttributeSet attrs) xml åˆ›å»ºå¯¹è±¡

> ç¬¬äºŒä¸ªå‚æ•° AttributeSet attrs å°±ä»£è¡¨äº†åœ¨ XML ä¸­ä¸º TextView å£°æ˜çš„å±æ€§é›†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒè§£æå‡ºå£°æ˜çš„å±æ€§å€¼ï¼Œä¾‹å¦‚ android:text å’Œ android:textSizeã€‚

åœ¨ xml ä¸­å®šä¹‰äº† View ç„¶ååœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ª View çš„æ—¶å€™ï¼Œè¿™ä¸ª View å°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ„é€ æ–¹æ³•ç”Ÿæˆçš„ã€‚View çš„å±æ€§å€¼æ¥è‡ª AttributeSet çš„å€¼

### æ„é€ æ–¹æ³• View(Context context,[@Nullable](/Nullable) AttributeSet attrs,int defStyleAttr) å…¨å±€ Theme

è¿™ä¸ªæ„é€ æ–¹æ³•å°±æ˜¯æä¾›äº†é»˜è®¤çš„ defStyleAttr ç”¨äºæŒ‡å®šåŸºæœ¬çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯å…è®¸ View æœ‰è‡ªå·±åŸºç¡€çš„é£æ ¼<br />ä¾‹å¦‚ Button ä¼šé»˜è®¤æä¾› `com.android.internal.R.attr.buttonStyle`

```java
public Button(Context context, AttributeSet attrs) {
    this(context, attrs, com.android.internal.R.attr.buttonStyle);
}
```

å¯ä»¥é€šè¿‡ Theme å…¨å±€æ§åˆ¶æ§ä»¶çš„æ ·å¼ï¼Œå…¶ä¸­çš„åŸç†å°±æ˜¯ä½¿ç”¨ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°

ä¸‰ä¸ªå‚æ•°æ„é€ å‡½æ•°çš„ä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç‰¹åˆ«ï¼Œä¸€èˆ¬æ˜¯äºŒä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥ä¸€ä¸ª Theme ä¸­çš„å±æ€§

```java
public TextView(Context context, @Nullable AttributeSet attrs) {
    this(context, attrs, com.android.internal.R.attr.textViewStyle);
}

public TextView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
    this(context, attrs, defStyleAttr, 0);
}
```

å¯ä»¥çœ‹åˆ°ï¼ŒTextView ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨çš„å€¼å°±æ˜¯ Theme ä¸­çš„ `com.android.internal.R.attr.textViewStyle` å±æ€§å€¼ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è¦†ç›– Theme ä¸­çš„ com.android.internal.R.attr.textViewStyleï¼Œå°±éœ€è¦è‡ªå®šä¹‰è¿™ä¸ªå±æ€§çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š

```xml
<style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar">
    <item name="colorPrimary">@color/colorPrimary</item>
    <item name="colorPrimaryDark">@color/colorPrimaryDark</item>
    <item name="colorAccent">@color/colorAccent</item>
    <!--å®šä¹‰TextViewä½¿ç”¨çš„å±æ€§-->
    <item name="android:textViewStyle">@style/MyTextViewStyle</item>
</style>

<!--è‡ªå®šä¹‰TextViewçš„é¢œè‰²-->
<style name="MyTextViewStyle" parent="Widget.AppCompat.TextView">
    <item name="android:textColor">@color/colorAccent</item>
</style>
```

### æ„é€ æ–¹æ³• View(Context context ,[@Nullable](/Nullable) AttributeSet attrs,int defStyleAttr,int defStyleRes) Â è‡ªå®šä¹‰ style

Theme æ˜¯å…¨å±€æ§åˆ¶æ ·å¼çš„ï¼Œä½†æ˜¯æ—¶å€™æˆ‘ä»¬åªæƒ³ä¸ºæŸå‡ ä¸ª TextView å•ç‹¬å®šä¹‰æ ·å¼ï¼Œé‚£å°±å¾—ä½¿ç”¨å››ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ã€‚

å››ä¸ªå‚æ•°æ„é€ å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ï¼Œä¸€èˆ¬æ˜¯åœ¨ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨ï¼Œå¹¶ä¼ å…¥è‡ªå®šä¹‰ Styleã€‚

é¦–å…ˆï¼Œåœ¨ styles.xml ä¸­å£°æ˜ä¸€ä¸ª TextView ä½¿ç”¨çš„ Style

```xml
<style name="CustomTextViewStyle" parent="Widget.AppCompat.TextView" >
    <item name="android:textColor">@color/colorPrimaryDark</item>
</style>
```

## å±æ€§å€¼çš„è¦†ç›–è§„åˆ™

æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šåœ°æ–¹èƒ½æ§åˆ¶å±æ€§å€¼ï¼Œé‚£ä¹ˆå°±æœ‰ä¸ªæœ‰é™é¡ºåºã€‚å…¶å®å¯ä»¥ä»å››ä¸ªå‚æ•°çš„ `View#obtainStyledAttributes()` æ–¹æ³•ä¸­çœ‹åˆ°è¿™ä¸ªè§„åˆ™

```
ç¬¬ä¸€ä¸ªå‚æ•°AttributeSet setæŒ‡çš„æ˜¯XMLä¸­å£°æ˜çš„å±æ€§é›†ã€‚

ç¬¬ä¸‰ä¸ªå‚æ•°int defStyleAttræŒ‡çš„æ˜¯Themeä¸­çš„æ§åˆ¶æ§ä»¶çš„å±æ€§ã€‚

ç¬¬å››ä¸ªå‚æ•°int defStyleResæŒ‡çš„æ˜¯è‡ªå®šä¹‰çš„Styleã€‚
```

> è·å–çš„ä¼˜å…ˆè§„åˆ™å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬å››ä¸ªå‚æ•°ã€‚

å¦‚æœåœ¨ XML ç»™æ§ä»¶ä½¿ç”¨ style å±æ€§å‘¢ï¼Ÿå®ƒçš„ä¼˜å…ˆçº§æ˜¯ä»‹äºç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°ä¹‹é—´ã€‚

```
1. XMLä¸­å±æ€§
2. XMLä¸­styleå±æ€§
3. Themeä¸­å±æ€§
4. æ„é€ å‡½æ•°è‡ªå®šä¹‰Style
```

# Android å¸ƒå±€ä¸­çš„ tools å±æ€§

<https://developer.android.com/studio/write/tool-attributes><br />tools å¯ä»¥è¦†ç›– android çš„æ‰€æœ‰æ ‡å‡†å±æ€§ï¼Œå°† android: æ¢æˆ tools: å³å¯ã€‚<br />åœ¨è¿è¡Œçš„æ—¶å€™ tools: æœ¬èº«æ˜¯è¢«å¿½ç•¥çš„ï¼Œä¸ä¼šè¢«å¸¦è¿› apk ä¸­ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨åˆ é™¤ã€‚

## tool å±æ€§ä½¿ç”¨

æ·»åŠ åç§°ç©ºé—´

```xml

xmlns:tools="http://schemas.android.com/tools"
```

## å¸¸è§å±æ€§

### Error handling attributes

#### 0ã€tools:parentTag

android studio2.2 æ–°åŠ äº†è¿™ä¸ªå±æ€§å¯ä»¥æŒ‡å®š `<merge>` æ ‡ç­¾çš„å¸ƒå±€ç±»å‹ï¼Œç”¨äºé¢„è§ˆ merge çš„å¸ƒå±€ï¼Œåœ¨è‡ªå®šä¹‰ç»„åˆå¸ƒå±€ä¸­éå¸¸å®ç”¨ã€‚

```xml

<?xml version="1.0" encoding="utf-8"?>

<merge

        xmlns:android="http://schemas.android.com/apk/res/android"

        xmlns:tools="http://schemas.android.com/tools"

        tools:parentTag="me.hacket.assistant.samples.ui.å£°æ³¢view.SoundRecordView"

        android:layout_width="match_parent"

        android:layout_height="wrap_content">

</merge>
```

#### 1ã€tools:ignore

ç”¨äº lintã€‚

å‹åˆ¶ lint è­¦å‘Šï¼Œé€šè¿‡é€—å·åŒºåˆ†ï¼Œå†™ lint idï¼›æˆ–è€… all å‹åˆ¶æ‰€æœ‰

```xml

<string name="show_all_apps" tools:ignore="MissingTranslation">All</string>
```

#### 2ã€tools:targetApi

ç”¨äº lintã€‚

æŒ‡å®šè¯¥ View æ˜¾ç¤ºçš„ç›®æ ‡ apiï¼ŒåŠŸèƒ½åŒ `@TargetApi` æ³¨è§£ã€‚

```xml

<GridLayout xmlns:android="http://schemas.android.com/apk/res/android"

    xmlns:tools="http://schemas.android.com/tools"

    tools:targetApi="14" >
```

#### 3ã€tools:locale

ç”¨äº resourceã€‚

ç”¨äºæŒ‡å®š resource çš„ locale è¯­è¨€ã€‚

```xml

<resources xmlns:tools="http://schemas.android.com/tools"

    tools:locale="es">
```

### Design-time view attributes

#### 1ã€tools: instead of android

ç”¨äº view ä¸Šã€‚

å¦‚ï¼š`tools:text`ï¼Œ`tools:visibility`

#### 2ã€tools:context

ç”¨äºå¸ƒå±€ root æ ‡ç­¾ä¸Šã€‚

æŒ‡å®šè¯¥å¸ƒå±€æ‰€å…³è”çš„ Activityï¼Œé€šè¿‡è¯¥å±æ€§ï¼Œå¯ä»¥å¿«é€Ÿçš„åˆ›å»ºå¦‚ onClick æ–¹æ³•å¯¹åº”çš„ Activityã€‚

#### 3ã€RecyclerView/ListView ç›¸å…³

- tools:itemCount æŒ‡å®š RecyclerView é¢„è§ˆçš„ item æ¡ç›®æ•°é‡

```xml

<android.support.v7.widget.RecyclerView

    android:id="@+id/recyclerView"

    android:layout_width="match_parent"

    android:layout_height="match_parent"

    tools:itemCount="3"/>
```

- tools:listitem item å¸ƒå±€é¢„è§ˆ
- tools:listheader item header é¢„è§ˆ
- tools:listfooter item footer é¢„è§ˆ

```xml

<com.qiushibaike.inews.widget.RecyclerListView

        android:layout_width="match_parent"

        android:layout_height="match_parent"

        tools:listheader="@layout/item_footer"

        tools:listfooter="@layout/item_footer"

        tools:listitem="@layout/item_article_one_image"

        tools:itemCount="2"

        android:id="@+id/rv_recyclerView_category_list"/>
```

#### 4ã€tools:layout

ä½œç”¨äº `<fragment>` æ ‡ç­¾ï¼Œé¢„è§ˆ fragment å¸ƒå±€

```xml

<fragment android:name="com.example.master.ItemListFragment"

    tools:layout="@layout/list_content" />
```

#### 5ã€tools:showIn

ä½œç”¨äºå¸ƒå±€ root æ ‡ç­¾ï¼Œæ·»åŠ çˆ¶å¸ƒå±€é¢„è§ˆã€‚ç”¨äºå°†è¯¥å¸ƒå±€ä½œä¸º `<include>` æ—¶ï¼Œåœ¨çˆ¶å¸ƒå±€çš„é¢„è§ˆ

```xml

<TextView xmlns:android="http://schemas.android.com/apk/res/android"

    xmlns:tools="http://schemas.android.com/tools"

    android:text="@string/hello_world"

    android:layout_width="wrap_content"

    android:layout_height="wrap_content"

    tools:showIn="@layout/activity_main" />
```

#### 6ã€tools:openDrawer

ä½œç”¨äº DrawerLayoutï¼Œè®© DrawerLayout æ‰“å¼€ä¸€ä¸ªæ–¹å‘ã€‚

å¯ä»¥ä¼ é€’ start,end,left,right

#### 7ã€"@tools:sample/*" èµ„æº

å…·ä½“å‚è€ƒï¼š<https://developer.android.com/studio/write/tool-attributes#toolssample_resources>

Attribute value	Description of placeholder data<br />@tools:sample/full_names	Full names that are randomly generated from the combination of@tools:sample/first_names and @tools:sample/last_names.<br />@tools:sample/first_names	Common first names.<br />@tools:sample/last_names	Common last names.<br />@tools:sample/cities	Names of cities from across the world.<br />@tools:sample/us_zipcodes	Randomly generated US zipcodes.<br />@tools:sample/us_phones	Randomly generated phone numbers with the following format: (800) 555-xxxx.<br />@tools:sample/lorem	Placeholder text that is derived from Latin.<br />@tools:sample/date/day_of_week	Randomized dates and times for the specified format.<br />@tools:sample/date/ddmmyy<br />@tools:sample/date/mmddyy<br />@tools:sample/date/hhmm<br />@tools:sample/date/hhmmss<br />@tools:sample/avatars	Vector drawables that you can use as profile avatars.<br />@tools:sample/backgrounds/scenic	Images that you can use as backgrounds.

### Resource shrinking attributes

#### 1ã€tools:shrinkMode

é€‚ç”¨å¯¹è±¡ï¼šã€‚

æŒ‡å®šæ„å»ºçš„æ—¶å€™æ˜¯ä½¿ç”¨ safe mode è¿˜æ˜¯ strict modeã€‚safe mode ä¿ç•™æ‰€æœ‰ç›´æ¥å¼•ç”¨çš„èµ„æºå’Œå¯èƒ½åŠ¨æ€ä½¿ç”¨çš„èµ„æºï¼Œæ¯”å¦‚ Resources.getIdentifier() æ–¹å¼è°ƒç”¨çš„èµ„æºã€‚strict mode åªä¿ç•™ç›´æ¥å¼•ç”¨çš„èµ„æºã€‚é»˜è®¤çš„å®‰å…¨æ¨¡å¼æ˜¯ shrinkMode="safe"ã€‚

å»ºç«‹ä¸€ä¸ª `res/raw/keep.xml` æ–‡ä»¶ï¼Œåœ¨ tools:keep å±æ€§ä¸­æŒ‡å®šæ¯ä¸ªè¦ä¿ç•™çš„èµ„æºï¼Œåœ¨ tools:discard å±æ€§ä¸­æŒ‡å®šæ¯ä¸ªè¦èˆå¼ƒçš„èµ„æºã€‚è¿™ä¸¤ä¸ªå±æ€§éƒ½æ¥å—é€—å·åˆ†éš”çš„èµ„æºåç§°åˆ—è¡¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ˜Ÿå·å­—ç¬¦ä½œä¸ºé€šé…ç¬¦

```xml

<?xml version="1.0" encoding="utf-8"?>

<resources xmlns:tools="http://schemas.android.com/tools"

    tools:keep="@layout/used_1,@layout/used_2,@layout/*_3" />
```

#### 2ã€tools:keep

é€‚ç”¨å¯¹è±¡ï¼šæ ‡ç­¾ã€‚è¿™ä¸ªå±æ€§èƒ½å¤Ÿä¿ç•™ç‰¹å®šçš„èµ„æºï¼Œæ¯”å¦‚ Resources.getIdentifier()) åŠ¨æ€ä½¿ç”¨çš„èµ„æºã€‚ç”¨æ³•æ˜¯å¯ä»¥åˆ›å»º res/raw/keep.xml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```xml

<?xml version="1.0" encoding="utf-8"?>

<resources xmlns:tools="http://schemas.android.com/tools"    

    tools:keep="@layout/used_1,@layout/used_2,@layout/*_3" />
```

#### 3ã€tools:discard

é€‚ç”¨å¯¹è±¡ï¼šæ ‡ç­¾ã€‚æœ‰äº›èµ„æºå¯èƒ½è¢«å¼•ç”¨ä½†æ˜¯åˆå¯¹ app æ²¡æœ‰å½±å“ï¼Œä¸èƒ½ç›´æ¥åˆ é™¤è¿™äº›èµ„æºï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å¯ä»¥ç§»é™¤è¿™äº›èµ„æºï¼›æˆ–è€… Gradle æ’ä»¶é”™è¯¯åœ°æ¨æ–­è¿™äº›èµ„æºæ˜¯è¢«å¼•ç”¨çš„ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š

```xml

<?xml version="1.0" encoding="utf-8"?>

<resources xmlns:tools="http://schemas.android.com/tools"

    tools:discard="@layout/unused_1" />
```

## sample data

éœ€æ±‚ï¼šä¸æƒ³è¦åœ¨èµ„æºç›®å½•ä¸­åŠ ä¸Šå¾ˆå¤šçš„é¢„è§ˆèµ„æº, å¦‚å›¾ç‰‡, æ–‡æœ¬ç­‰, ä»–ä»¬ä»…ä»…åœ¨é¢„è§ˆçš„æ—¶å€™æœ‰ç”¨, æ‰“åŒ…æ—¶æˆ‘å¹¶ä¸éœ€è¦å°†å®ƒä»¬ä¹Ÿæ‰“åŒ…è¿› APKï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ° `sample data`ã€‚

ä» Android Studio 3.0 å¼€å§‹, æˆ‘ä»¬å°±èƒ½å¤Ÿä½¿ç”¨ Android Studio æä¾›çš„é¢„å®šä¹‰æ•°æ®, æˆ–è€…è‡ªè¡Œåˆ›å»ºä¸€ä¸ª `Sample data` çš„ç›®å½•, ç„¶åæ”¾å…¥ä¸€äº›å‡çš„æ•°æ®ä»¥ä¾›é¢„è§ˆä½¿ç”¨.

### é¢„å®šä¹‰æ•°æ®

Android Studio 3.0 å¼€å§‹æä¾›äº†ä¸€ç³»åˆ—çš„é¢„å®šä¹‰æ•°æ®, æˆ‘ä»¬å¯ä»¥åœ¨ tools:text å±æ€§ä½¿ç”¨ `@tools/data/`:

```xml
tools:text="@tools:sample/last_names"
```

é™¤äº† text ç±»å‹çš„, é¢„å®šä¹‰æ•°æ®è¿˜åŒ…æ‹¬:

| å±æ€§å€¼                                | å ä½æ•°æ®æè¿°                                                                             |
| ---------------------------------- | ---------------------------------------------------------------------------------- |
| `@tools:sample/full_names`         | éšæœºç”Ÿæˆçš„ `@tools:sample/first_names`<br /> and `@tools:sample/last_names`<br /> çš„ç»„åˆåç§° |
| `@tools:sample/first_names`        | å¸¸ç”¨çš„å                                                                               |
| `@tools:sample/last_names`         | å¸¸ç”¨çš„å§“                                                                               |
| `@tools:sample/cities`             | ä¸–ç•ŒèŒƒå›´å†…åŸå¸‚çš„åå­—                                                                         |
| `@tools:sample/us_zipcodes`        | éšæœºç”Ÿæˆçš„ğŸ‡ºğŸ‡¸é‚®æ”¿ç¼–ç                                                                       |
| `@tools:sample/us_phones`          | éšæœºç”Ÿæˆçš„ğŸ‡ºğŸ‡¸â˜ï¸å·ç , ç¬¦åˆä¸‹é¢çš„æ ¼å¼: (800) 555-xxxx                                             |
| `@tools:sample/lore`               | èµ·æºäºæ‹‰ä¸æ–‡çš„å ä½æ–‡å­—                                                                        |
| `@tools:sample/date/day_of_week`   | éšæœºçš„ç‰¹å®šæ ¼å¼çš„æ—¥æœŸå’Œæ—¶é—´                                                                      |
| `@tools:sample/date/ddmmyy`        |                                                                                    |
| `@tools:sample/date/mmddyy`        |                                                                                    |
| `@tools:sample/date/hhmm`          | `@tools:sample/date/hhmmss`                                                        |
| `@tools:sample/avatars`            | å¯ä»¥ç”¨äºäººç‰©å¤´åƒçš„ vector drawables                                                         |
| `@tools:sample/backgrounds/scenic` | å¯ä»¥ç”¨äºèƒŒæ™¯çš„å›¾ç‰‡                                                                          |

æ¡ˆä¾‹ï¼š

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".samples.ui.æ‚é¡¹.sampledata.SampleDataDemo">


    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/last_names" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/first_names" />


    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/full_names" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/cities" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/us_zipcodes" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/us_phones" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/lorem" />

    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="TextView"
        tools:text="@tools:sample/date/mmddyy" />

    <ImageView
        android:layout_width="50dp"
        android:layout_height="50dp"
        android:text="TextView"
        tools:src="@tools:sample/avatars" />

    <ImageView
        android:layout_width="50dp"
        android:layout_height="50dp"
        android:text="TextView"
        tools:src="@tools:sample/backgrounds/scenic" />
    
</LinearLayout>
```

![](https://cdn.nlark.com/yuque/0/2023/png/694278/1688399709252-8df654ca-6ebe-40b5-85e7-187fc1189843.png#averageHue=%23dcdbda&clientId=ubb8c424d-ae2e-4&from=paste&id=uba5077ce&originHeight=766&originWidth=518&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u7842223a-4985-4763-88e3-dc1abcbc6d1&title=)<br />![](http://note.youdao.com/yws/res/29205/C964A50E8AA84C1D867BE75349942E15#id=OseLF&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

### è‡ªå®šä¹‰ sample data

åœ¨ app (module) æ–‡ä»¶å¤¹å³é”®, é€‰æ‹© `new -> Sample Data directory` åˆ›å»ºå­˜æ”¾å‡æ•°æ®çš„ `sample data` æ–‡ä»¶å¤¹ã€‚<br />![](https://cdn.nlark.com/yuque/0/2023/png/694278/1688399763341-7bce7bc2-64ce-48e0-a381-87ef95695dad.png#averageHue=%2342464d&clientId=ubb8c424d-ae2e-4&from=paste&id=u2cfd29f6&originHeight=641&originWidth=1280&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=ub556f4f5-f537-4030-93e1-74fc0f09e9b&title=)<br />![](http://note.youdao.com/yws/res/29209/5EB14233A3B84FB886B28F478E6AC676#id=n3vcB&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹, æˆ‘ä»¬åˆ›å»ºæ–‡æœ¬æ–‡ä»¶å¦‚ txt æ–‡ä»¶, æ·»åŠ ä¸€äº›åŸå§‹æ•°æ®å¦‚ `#ff33aa` (æ˜¯çš„, å¯ä»¥æ”¾ç½®é¢œè‰²) æˆ–è€…å°±æ˜¯ç®€å•çš„æ–‡å­—, éœ€è¦ä¸»è¦æ¯æ·»åŠ ä¸€æ¡æ•°æ®åéœ€è¦æ¢è¡Œ, æ¢è¨€ä¹‹æ¯è¡Œæ•°æ®å ä¸€è¡Œ. ç„¶åå†å¸ƒå±€æ–‡ä»¶ä¸­æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ tools:text å±æ€§å¼•ç”¨ @sample/å­˜æ”¾æ•°æ®çš„æ–‡ä»¶çš„åç§° .

#### 1. æ™®é€šæ–‡æœ¬

```
ä½ çŒœæˆ‘æ˜¯è° ã€‚1\n
æˆ‘ç®¡
1
2
```

#### 2. å¯ä»¥åˆ›å»º JSON æ–‡ä»¶æ¥å±•ç¤ºå¤æ‚çš„æ•°æ®

```json
{
  "github_users": [
    {
      "name": "Nick Butcher",
      "github": "https://github.com/nickbutcher"
    },
    {
      "name": "Chris Banes",
      "github": "https://github.com/chrisbanes"
    },
    {
      "name": "Jake Wharton",
      "github": "https://github.com/JakeWharton"
    },
    {
      "name": "Romain Guy",
      "github": "https://github.com/romainguy"
    }
  ]
}
```

> éœ€è¦æ³¨æ„çš„æ˜¯, è¿™é‡Œè¦æ±‚ JSON æ–‡ä»¶å¼€å¤´ä¸èƒ½æ˜¯ JsonArray, åªèƒ½æ˜¯ JsonObject. åˆ›å»ºå®Œæˆå,éœ€è¦é‡æ–°ç¼–è¯‘ä¸€ä¸‹æ‰èƒ½å¼•ç”¨åˆ°æœ€æ–°çš„æ•°æ®.

#### 3. é¢œè‰²

```shell
# FF4336
# 9727BO
# 673AB7
```

å¼•ç”¨ï¼š

```xml
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        tools:text="@sample/test.txt" />

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        tools:text="@sample/github_user.json/github_users/name" />

    <ImageView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:src="@drawable/ic_avatar"
        tools:tint="@sample/test_color" />

    <ImageView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:src="@drawable/ic_avatar"
        tools:tint="@sample/test_color" />

    <ImageView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:src="@drawable/ic_avatar"
        tools:tint="@sample/test_color" />
</LinearLayout>
```

![](https://cdn.nlark.com/yuque/0/2023/png/694278/1688399772735-078d4f13-5cbb-45e3-a9ba-b18dd9c18cf9.png#averageHue=%23d7b0a8&clientId=ubb8c424d-ae2e-4&from=paste&height=487&id=u90ee41fe&originHeight=910&originWidth=510&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u85979ded-81ef-4d65-a2ba-b79167a2cea&title=&width=273)<br />![](http://note.youdao.com/yws/res/29223/84E2489C7FA646CBB219B7F4FFD0A505#id=ogYM5&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

# foreground åº”ç”¨

foreground ä¹Ÿå°±æ˜¯å‰æ™¯è‰²ï¼Œéœ€è¦æ³¨æ„ï¼Œforeground çš„æ”¯æŒæ˜¯åœ¨ Android 6.0ï¼ˆä¹Ÿå°±æ˜¯ API 23ï¼‰æ‰åŠ å…¥çš„ï¼›ä¹‹å‰å…¶å®ä¹Ÿæœ‰ï¼Œä¸è¿‡åªæ”¯æŒ FrameLayoutï¼Œè€Œç›´åˆ° 6.0 æ‰æŠŠè¿™ä¸ªæ”¯æŒæ”¾è¿›äº† View ç±»é‡Œã€‚

Android åœ¨æ‰€æœ‰å¸ƒå±€çš„åŸºç±» View ç±»ä¸­ å°±å®šä¹‰äº† Foreground è¿™ä¸ªå±æ€§ï¼Œå› ä¸º API ç‰ˆæœ¬æ²¡æœ‰ 23 çš„è¯ï¼Œåªæœ‰ FrameLayout å¸ƒå±€ä¸Šè®¾ç½®è¯¥å±æ€§æ‰ä¼šç”Ÿæ•ˆã€‚è§‚å¯Ÿ View çš„ä»£ç å‘ç°è¿™æ ·ä¸€æ®µã€‚å®ƒåªé’ˆå¯¹æ˜¯ FrameLayout çš„å®ä¾‹åšè·å–è¯¥ styleable çš„æ“ä½œã€‚

```java
case R.styleable.View_foreground:
    if (targetSdkVersion >= VERSION_CODES.M || this instanceof FrameLayout) {
         setForeground(a.getDrawable(attr));
    }
    break;
case R.styleable.View_foregroundGravity:
    if (targetSdkVersion >= VERSION_CODES.M || this instanceof FrameLayout) {
    setForegroundGravity(a.getInt(attr, Gravity.NO_GRAVITY));
    }
    break;
```

## foreground åº”ç”¨

### æ•´ä¸ªæ§ä»¶å®¹å™¨çš„é®ç½©

foreground æ˜¯ç›–åœ¨æ•´ä¸ªæ§ä»¶æœ€ä¸Šå±‚ï¼Œå¯ä»¥ä½œä¸ºé®ç½©å±‚

### å®ç°ä¸€ç§ç‚¹å‡»æŸ¥çœ‹çš„æ•ˆæœ

> æ¯”å¦‚é‚£ç§ç‚¹å‡»æŸ¥çœ‹è°œåº•çš„åŠŸèƒ½å°±å¯ä»¥ç®€å•ç”¨è¿™ç§æ–¹æ³•å®ç°

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical">

    <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="ä¸–ç•Œä¸Šæœ€å¸…çš„ç¨‹åºå‘˜æ˜¯è°ï¼Ÿç‚¹å‡»ä¸‹æ–¹æŸ¥çœ‹è°œåº•ç­”æ¡ˆ" />

    <FrameLayout
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:clickable="true"
            android:foreground="@drawable/forceground_drawable">

        <LinearLayout
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="vertical">

            <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="ä¸–ç•Œä¸Šæœ€å¸…çš„ç¨‹åºå‘˜æ˜¯é’è›™è¦flyï¼Œä¸–ç•Œä¸Šæœ€å¥½ç”¨çš„è¯­è¨€æ˜¯PHP" />

        </LinearLayout>
    </FrameLayout>
</LinearLayout>
```

selector

```xml
<?xml version="1.0" encoding="utf-8"?>
<selector xmlns:android="http://schemas.android.com/apk/res/android">
    <item android:state_pressed="true" android:drawable="@color/colorAccent1"/>
    <item android:drawable="@color/colorAccent2" />
</selector>
```

color

```xml
<color name="colorAccent1">#00ffffff</color>
<color name="colorAccent2">#ffc0c0c0</color>
```

### ä½¿ç”¨ä¸€è¡Œä»£ç å°±å®ç°äº†æ°´æ³¢çº¹æ•ˆæœ

```xml
android:foreground="?selectableItemBackground"
```

> å¦‚æœæ— æ•ˆçš„è¯ï¼Œæ£€æŸ¥æ˜¯å¦ clickable æ˜¯å¦ä¸º true.

- æ°´æ³¢çº¹æ”¹è‰²ï¼Œè¿™ä¸ªéœ€è¦åœ¨ä¸»é¢˜ä¸­è¿›è¡Œé…ç½® ï¼Œé…ç½®ä»£ç å¦‚ä¸‹

```
<item name="colorControlHighlight">@color/accent_material_light</item>
```

# é€æ˜åº¦å¯¹åº” 16 è¿›åˆ¶å€¼ï¼ˆåå…­è¿›åˆ¶ï¼‰

## è®¡ç®—æ–¹æ³•

`255 * ä¸é€æ˜åº¦ -> è½¬æ¢æˆ16è¿›åˆ¶æ•°`

```java
//javaä»£ç ç”Ÿæˆçš„å¯¹åº”è¡¨
for (int i = 100; i>=0; i--) {
   double j = (i / 100.0d);
   int alpha = (int) Math.round(255-j * 255);
   String hex = Integer.toHexString(alpha).toUpperCase();
   if (hex.length() == 1) hex = "0" + hex;
   int percent = (int) (j*100);
   System.out.println(String.format("%d%% â€” %s", percent, hex));
}
```

## ä¸é€æ˜åº¦ 16 è¿›åˆ¶å€¼ã€åå…­è¿›åˆ¶é¢œè‰²

```
100% â€” FFï¼ˆå®Œå…¨ä¸é€æ˜ï¼‰
99% â€” FC
98% â€” FA
97% â€” F7
96% â€” F5
95% â€” F2
94% â€” F0
93% â€” ED
92% â€” EB
91% â€” E8
90% â€” E6
89% â€” E3
88% â€” E0
87% â€” DE
86% â€” DB
85% â€” D9
84% â€” D6
83% â€” D4
82% â€” D1
81% â€” CF
80% â€” CC
79% â€” C9
78% â€” C7
77% â€” C4
76% â€” C2
75% â€” BF
74% â€” BD
73% â€” BA
72% â€” B8
71% â€” B5
70% â€” B3
69% â€” B0
68% â€” AD
67% â€” AB
66% â€” A8
65% â€” A6
64% â€” A3
63% â€” A1
62% â€” 9E
61% â€” 9C
60% â€” 99
59% â€” 96
58% â€” 94
57% â€” 91
56% â€” 8F
55% â€” 8C
54% â€” 8A
53% â€” 87
52% â€” 85
51% â€” 82
50% â€” 80
49% â€” 7D
48% â€” 7A
47% â€” 78
46% â€” 75
45% â€” 73
44% â€” 70
43% â€” 6E
42% â€” 6B
41% â€” 69
40% â€” 66
39% â€” 63
38% â€” 61
37% â€” 5E
36% â€” 5C
35% â€” 59
34% â€” 57
33% â€” 54
32% â€” 52
31% â€” 4F
30% â€” 4D
29% â€” 4A
28% â€” 47
27% â€” 45
26% â€” 42
25% â€” 40
24% â€” 3D
23% â€” 3B
22% â€” 38
21% â€” 36
20% â€” 33
19% â€” 30
18% â€” 2E
17% â€” 2B
16% â€” 29
15% â€” 26
14% â€” 24
13% â€” 21
12% â€” 1F
11% â€” 1C
10% â€” 1A
9% â€” 17
8% â€” 14
7% â€” 12
6% â€” 0F
5% â€” 0D
4% â€” 0A
3% â€” 08
2% â€” 05
1% â€” 03
0% â€” 00ï¼ˆå…¨é€æ˜ï¼‰
```
