---
date_created: Tuesday, November 19th 2020, 11:27:19 pm
date_updated: Wednesday, January 22nd 2025, 11:23:36 pm
title: 04.Kotlin与Gradle
author: hacket
categories:
  - Android
category: 构建系统
tags: [Gradle]
toc: true
description: 
dg-publish: true
dg-enable-search: true
dg-show-local-graph: true
dg-show-toc: true
dg-show-file-tree: true
image-auto-upload: true
feed: show
format: list
date created: 2024-12-26 00:18
date updated: 2024-12-26 00:18
aliases: [Kotlin 之 Gradle 基础]
linter-yaml-title-alias: Kotlin 之 Gradle 基础
---

# Kotlin 之 Gradle 基础

## gradle project 和 task

## 用 kotlin 自定义 task

## gradle 依赖

## gradle 生命周期

1. 扫描
2. 执行

```kotlin
task("opendoor", {
    println("open door scan1") // 扫描阶段
    doFirst({
        println("open door first") // 运行阶段
    })
    println("open door scan2") // 扫描阶段
    doLast({
        println("open door last") // 运行阶段
    })
})
task("putelephant", {
    println("put elephant scan")
    doFirst({
        println("put elephant first")
    })
    doLast({
        println("put elephant last")
    })
}).dependsOn("opendoor")
task("closedoor", {
    println("close door scan")
    doFirst({
        println("close door first")
    })
    doLast({
        println("close door last")
    })
}).dependsOn("putelephant")
```

## Tasks 任务集

多个任务的合集就是任务集

```kotlin
tasks { // 定义一堆任务
  "xxx"{
   }
}
```

gradle 默认 tasks，用命令 `gradle tasks` 查看默认 task

defaultTasks，定义 gradle 不输入 task 执行的默认 task

## Gradle 增量更新

```kotlin
inputs.dir
inputs.file
outputs.dir
outputs.file
```

案例：把源代码的文件路径记录下来

```kotlin
task("getsrcname", {
    var outputfile = file("ouput.txt")
    doLast {
        var srcDir = fileTree("src")
        srcDir.forEach({
            if (it.isFile) {
                Thread.sleep(1000)
                outputfile.appendText(it.absolutePath)
                outputfile.appendText("\r\n")
            }
        })
    }
})
```

未加入增量更新，如果没有变化，每次运行都需要 3s，加入只需要 0s，没有变化的 task 会是 `UP-TO-DATE` 状态

```kotlin
task("getsrcname", {
    var outputfile = file("ouput.txt")
    inputs.dir("src")
    outputs.file(outputfile)
    doLast {
        var srcDir = fileTree("src")
        srcDir.forEach({
            if (it.isFile) {
                Thread.sleep(1000)
                outputfile.appendText(it.absolutePath)
                outputfile.appendText("\r\n")
            }
        })
    }
})
```

## Gradle 常见插件

插件就是包含一个或多个 task 的合集

1. application
2. java
3. war

# Kotlin 之 Gradle DSL

<https://github.com/gradle/kotlin-dsl><br /><https://blog.gradle.org/kotlin-meets-gradle>

## build.gradle 转 build.gradle.kts

### settings.gradle

#### include

```shell
include ':lancet-base'
project(':lancet-base').projectDir = File('lancet/lancet-base')
include ':lancet-weaver'
project(':lancet-weaver').projectDir = File('lancet/lancet-weaver')
include ':lancet-plugin'
project(':lancet-plugin').projectDir = File('lancet/lancet-plugin')
```

kotlin script:

```kotlin
include(":lancet-base")
project(":lancet-base").projectDir = File("lancet/lancet-base")
include(":lancet-weaver")
project(":lancet-weaver").projectDir = File("lancet/lancet-weaver")
include(":lancet-plugin")
project(":lancet-plugin").projectDir = File("lancet/lancet-plugin")
```

### [resolutionStrategy.dependencySubstitution substitute](https://docs.gradle.org/current/userguide/resolution_rules.html#sec:dependency_substitution_rules)

- groovy

```groovy
configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute module("org.utils:api") using project(":api") because "we work with the unreleased development version"
        substitute module("org.utils:util:2.5") using project(":util")
    }
}
```

- kts

```kotlin
configurations.all {
    resolutionStrategy.dependencySubstitution {
        substitute(module("org.utils:api"))
            .using(project(":api")).because("we work with the unreleased development version")
        substitute(module("org.utils:util:2.5")).using(project(":util"))
    }
}
```
